<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#004a99">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <title>Checklist Pague Menos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { 
            --primary: #004a99; 
            --accent: #f9b233;
            --bg: #f4f7f9; 
        }

        * { 
            box-sizing: border-box; 
            -webkit-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: var(--bg); 
            margin: 0; 
            padding: 0;
            display: flex; 
            flex-direction: column; 
            justify-content: space-between;
            align-items: center;
            overflow: hidden;
            width: 100vw;
            height: 100dvh;
           overscroll-behavior: none;

        }

        /* --- BOTÃO ENGRENAGEM FIXO --- */
        .btn-settings {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 1001;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            backdrop-filter: blur(5px);
            cursor: pointer;
        }

        /* --- MODAL DE CONFIGURAÇÕES --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 20000;
            padding: 20px;
        }

        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 20px;
            width: 100%;
            max-width: 320px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .modal-content h3 { color: var(--primary); margin-top: 0; margin-bottom: 20px; }

        .menu-opt {
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid #eee;
            border-radius: 12px;
            background: #f9f9f9;
            color: #444;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }

        .menu-opt i { color: var(--primary); width: 20px; }
        .menu-opt.install-ready { background: #fff4e0; border-color: var(--accent); }

        /* --- ANIMAÇÃO DE TRANSIÇÃO --- */
        #transition-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column;
            pointer-events: none; z-index: 10000;
        }
        .transition-bar { flex: 1; width: 100%; background: var(--primary); transform: scaleX(0); transform-origin: left; transition: transform 0.4s ease-in-out; }
        .transition-bar:nth-child(even) { transform-origin: right; background: #003a7a; }
        body.page-exit .transition-bar { transform: scaleX(1); }

        .hero h1 { font-size: clamp(32px, 12vw, 48px) !important; }

        #toast-container {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            z-index: 9999; width: auto; pointer-events: none;
            display: flex; flex-direction: column; align-items: center;
        }
        .toast {
            background: rgba(0, 74, 153, 0.95); color: white; padding: 12px 20px; border-radius: 12px; font-size: 13px; font-weight: 500;
            box-shadow: 0 8px 15px rgba(0,0,0,0.15); margin-bottom: 8px; opacity: 0; transition: all 0.3s ease;
            transform: translateY(20px); display: flex; align-items: center; gap: 10px; border-left: 4px solid var(--accent);
        }
        .toast.show { opacity: 1; transform: translateY(0); }

        .icon-fixo { position: absolute; top: 15px; left: 15px; width: clamp(35px, 10vw, 45px); border-radius: 10px; z-index: 100; }

        .hero {
            position: relative; width: 100%; background: var(--primary); padding: clamp(60px, 15vh, 100px) 20px clamp(40px, 10vh, 60px) 20px;
            text-align: center; color: white; border-bottom-left-radius: 40px; border-bottom-right-radius: 40px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden; perspective: 1000px;
        }

        .lupa-container {
            position: absolute; z-index: 5; pointer-events: none; display: flex; align-items: center; justify-content: center;
            animation: inspecaoZ 7s infinite ease-in-out; will-change: transform, top, left;
        }
        .lupa-vidro { width: 38px; height: 38px; border: 3px solid #fff; border-radius: 50%; position: relative; background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(1.5px); box-shadow: inset 0 0 8px rgba(255,255,255,0.4), 0 5px 15px rgba(0,0,0,0.3); }
        .lupa-cabo { width: 12px; height: 4px; background: #fff; position: absolute; right: -8px; bottom: 2px; transform: rotate(45deg); border-radius: 2px; }

        @keyframes inspecaoZ {
            0%   { top: 20%; left: 15%; transform: translateZ(0px) rotate(0deg); }
            25%  { top: 35%; left: 40%; transform: translateZ(50px) scale(1.3) rotate(-5deg); }
            55%  { top: 55%; left: 55%; transform: translateZ(-20px) scale(0.9) rotate(10deg); }
            100% { top: 20%; left: 15%; transform: translateZ(0px) scale(1) rotate(0deg); }
        }

        .hero h1 { margin: 0; font-size: clamp(24px, 8vw, 32px); font-weight: 800; letter-spacing: 2px; }
        .hero p { margin: 5px 0 0 0; font-size: clamp(12px, 4vw, 16px); opacity: 0.9; text-transform: uppercase; letter-spacing: clamp(2px, 1vw, 4px); }

        .menu-container { width: 90%; max-width: 450px; margin-top: -30px; z-index: 10; padding-bottom: 20px; }
        .main-button {
            background: white; display: flex; align-items: center; padding: clamp(15px, 5vw, 22px); border-radius: 20px;
            text-decoration: none; color: var(--primary); box-shadow: 0 10px 20px rgba(0,0,0,0.08); margin-bottom: 15px;
            border: 1px solid rgba(0,0,0,0.05); transition: transform 0.2s; cursor: pointer;
        }
        .main-button i { font-size: clamp(30px, 10vw, 38px); margin-right: 15px; color: var(--accent); }
        .main-button h3 { margin: 0; font-size: clamp(16px, 5vw, 18px); }
        .main-button p { margin: 0; font-size: clamp(11px, 3.5vw, 13px); color: #777; }

        .secondary-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .sec-button {
            background: white; padding: clamp(12px, 4vw, 18px); border-radius: 20px; text-align: center; text-decoration: none; color: #444;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); font-size: clamp(12px, 3.5vw, 14px); font-weight: 600; transition: transform 0.2s; cursor: pointer;
        }
        .sec-button i { display: block; font-size: clamp(18px, 6vw, 22px); margin-bottom: 8px; color: var(--primary); }
        
        .footer-logo { margin-top: auto; padding: 20px 0; text-align: center; width: 100%; }
        .footer-logo img { width: clamp(90px, 25vw, 110px); border-radius: 12px; margin-bottom: 8px; }
        footer { font-size: clamp(10px, 3vw, 11px); color: #999; }
        
        
        /* Container do card de versão */
.version-card {
    margin-top: 12px;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 12px;
    background: rgba(0, 74, 153, 0.05); /* Azul bem clarinho e transparente */
    border: 1px solid rgba(0, 74, 153, 0.1);
    border-radius: 100px; /* Estilo pílula */
    transition: all 0.3s ease;
}

/* Texto "VERSÃO:" */
.version-label {
    font-size: 9px;
    font-weight: 800;
    color: var(--primary);
    letter-spacing: 0.5px;
    text-transform: uppercase;
}

/* O número da versão em si */
#app-version-display {
    font-family: 'Courier New', Courier, monospace; /* Fonte estilo sistema */
    font-size: 11px;
    font-weight: bold;
    color: var(--accent); /* Destaque na cor amarela do seu sistema */
}

/* Efeito sutil ao passar o mouse (opcional) */
.version-card:hover {
    background: rgba(0, 74, 153, 0.1);
    transform: translateY(-1px);
}

    </style>
</head>
<body>
    
<div id="update-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px); z-index: 99998;"></div>

<div id="update-banner" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 85%; max-width: 320px; background: white; z-index: 99999; padding: 30px 20px; border-radius: 28px; box-shadow: 0 25px 50px rgba(0,0,0,0.5); text-align: center; flex-direction: column; align-items: center; gap: 15px; border: none; animation: modalPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);">
    <div style="background: #f4f7f9; width: 70px; height: 70px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #004a99; font-size: 32px; margin-bottom: 5px;">
        <i class="fas fa-sync-alt fa-spin"></i>
    </div>
    <div style="margin-bottom: 10px;">
        <h3 style="margin: 0; color: #004a99; font-size: 20px; font-weight: 800; font-family: sans-serif;">Atualização Necessária</h3>
        <p style="margin: 12px 0 0 0; color: #555; font-size: 14px; line-height: 1.5; font-family: sans-serif;">Uma nova versão do Checklist está disponível com melhorias essenciais.</p>
    </div>
    <button onclick="forceUpdate()" id="btn-update-now" style="background: #004a99; color: white; border: none; width: 100%; padding: 16px; border-radius: 14px; font-weight: 800; cursor: pointer; font-size: 14px; box-shadow: 0 8px 20px rgba(0,74,153,0.3); transition: all 0.2s; font-family: sans-serif;">
        ATUALIZAR AGORA
    </button>
</div>

<style>
    @keyframes modalPop {
        from { opacity: 0; transform: translate(-50%, -60%) scale(0.8); }
        to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    }
    /* Garante que o corpo não role quando o modal estiver aberto */
    body.modal-open { overflow: hidden !important; height: 100vh !important; }
</style>




    <button class="btn-settings" onclick="toggleMenu(true)">
        <i class="fas fa-cog"></i>
    </button>

    <div id="modal-settings" class="modal-overlay" onclick="toggleMenu(false)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h3>Configurações</h3>
            
            <div id="opt-instalar" class="menu-opt" style="display: none;" onclick="instalarApp()">
                <i class="fas fa-mobile-alt"></i> Instalar Aplicativo
            </div>

            <div class="menu-opt" onclick="limparCacheSistema()">
                <i class="fas fa-sync-alt"></i> Atualizar Sistema
            </div>

            <button class="main-button" style="margin-top: 15px; width: 100%; justify-content: center; padding: 12px;" onclick="toggleMenu(false)">
                FECHAR
            </button>
        </div>
    </div>

    <div id="transition-overlay">
        <div class="transition-bar"></div>
        <div class="transition-bar"></div>
        <div class="transition-bar"></div>
        <div class="transition-bar"></div>
    </div>

    <div id="toast-container"></div>

    <img src="icone_novo.png" class="icon-fixo" alt="Ícone">

    <div class="hero">
        <div class="lupa-container">
            <div class="lupa-vidro"></div>
            <div class="lupa-cabo"></div>
        </div>
        <h1>CHECK-LIST</h1>
        <p>CLIENTE OCULTO</p>
    </div>

    <div class="menu-container">
        <a href="javascript:void(0)" onclick="transitionTo('checklist.html')" class="main-button">
            <i class="fas fa-file-signature"></i>
            <div>
                <h3>Nova Avaliação</h3>
                <p>Iniciar auditoria agora</p>
            </div>
        </a>

        <div class="secondary-grid">
            <a href="#" class="sec-button" onclick="showToast('Histórico em desenvolvimento')">
                <i class="fas fa-history"></i> Histórico
            </a>
            <a href="#" class="sec-button" onclick="showToast('Relatórios em desenvolvimento')">
                <i class="fas fa-chart-line"></i> Relatórios
            </a>
        </div>
    </div>

  <div class="footer-logo">
    <img src="PagueMenosLogo.png" alt="Pague Menos">
    <footer>
        Desenvolvido por <strong>Erik Henrique - 126841</strong><br>
        <strong>Sistema não oficial</strong>, voltado ao apoio e acompanhamento do atendimento em relação ao cliente oculto.
        <br>
        
        <div class="version-card">
            <span class="version-label">Versão</span>
            <span id="app-version-display">---</span>
        </div>
    </footer>
</div>


   

 <script>
    /* --- LÓGICA DE VERSÃO DINÂMICA --- */
    let deferredPrompt;
    const optInstalar = document.getElementById('opt-instalar');
    const updateBanner = document.getElementById('update-banner');
    const updateOverlay = document.getElementById('update-overlay');

    /* --- INSTALAÇÃO PWA --- */
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        if (optInstalar) {
            optInstalar.style.display = 'flex';
            optInstalar.classList.add('install-ready');
        }
    });

    async function instalarApp() {
        if (deferredPrompt) {
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            if (outcome === 'accepted') {
                optInstalar.style.display = 'none';
                toggleMenu(false);
            }
            deferredPrompt = null;
        }
    }

    /* --- CONTROLE DE ATUALIZAÇÃO --- */
    async function checkVersion() {
        try {
            const response = await fetch(`version.json?v=${Date.now()}`);
            if (!response.ok) return;
            
            const data = await response.json();
            const serverVersion = data.version;
            const localVersion = localStorage.getItem('app_version');

            if (!localVersion) {
                localStorage.setItem('app_version', serverVersion);
                return;
            }

            if (serverVersion !== localVersion) {
                exibirBloqueioAtualizacao();
                localStorage.setItem('app_version', serverVersion);
            }
        } catch (err) {
            console.warn("Erro ao validar versão.");
        }
    }

    function exibirBloqueioAtualizacao() {
        if (updateBanner && updateOverlay) {
            updateOverlay.style.display = 'block';
            updateBanner.style.display = 'flex';
            document.body.classList.add('modal-open');
        }
    }

    async function forceUpdate() {
        const btn = document.getElementById('btn-update-now');
        if (btn) {
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Atualizando...';
            btn.disabled = true;
        }

        showToast("Limpando cache...");
        
        if ('serviceWorker' in navigator) {
            const regs = await navigator.serviceWorker.getRegistrations();
            for (let reg of regs) await reg.unregister();
        }
        
        if ('caches' in window) {
            const names = await caches.keys();
            await Promise.all(names.map(name => caches.delete(name)));
        }

        setTimeout(() => {
            window.location.reload(true);
        }, 1000);
    }

    /* --- UI FUNCTIONS --- */
    function toggleMenu(show) {
        const modal = document.getElementById('modal-settings');
        if (modal) modal.style.display = show ? 'flex' : 'none';
    }

    function transitionTo(url) {
        document.body.classList.add('page-exit');
        setTimeout(() => { window.location.href = url; }, 450);
    }

    function showToast(message) {
        const container = document.getElementById('toast-container');
        if (!container) return;
        if (container.children.length >= 2) container.removeChild(container.firstChild);
        const toast = document.createElement('div');
        toast.className = 'toast';
        toast.innerHTML = `<i class="fas fa-info-circle"></i> ${message}`;
        container.appendChild(toast);
        setTimeout(() => toast.classList.add('show'), 10);
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => toast.remove(), 300);
        }, 2500);
    }

    /* --- INICIALIZAÇÃO --- */
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js').then(reg => {
            reg.addEventListener('updatefound', () => {
                const newWorker = reg.installing;
                newWorker.addEventListener('statechange', () => {
                    if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                        exibirBloqueioAtualizacao();
                    }
                });
            });
        });
    }

    checkVersion();
    setInterval(checkVersion, 1000 * 60 * 15);
    document.addEventListener('visibilitychange', () => {
        if (document.visibilityState === 'visible') checkVersion();
    });
    
    async function displayVersion() {
    try {
        const response = await fetch(`version.json?v=${Date.now()}`);
        if (response.ok) {
            const data = await response.json();
            document.getElementById('app-version-display').innerText = data.version;
        }
    } catch (err) {
        document.getElementById('app-version-display').innerText = "---";
    }
}

// Chame a função logo após o checkVersion() no final do arquivo
displayVersion();

</script>

   


</body>
</html>
